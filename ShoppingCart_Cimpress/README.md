Problem Statement:

Shopping cart can have two type of items in it: Coupons and Products. There can be any number of different types of Products. Only three types of Coupons:

Coupon All: Apply price reduction to all items in cart.
Coupon Next: Reduce the next non coupon item by percent.
Coupon Type: D% off on Nth item of Type T.
Goal is to calculate total price of all items in the cart for checkout.